"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5322],{6335:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"Vue/Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790","title":"Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790","description":"\u517b\u6210\u9605\u8bfb\u6e90\u7801\u7684\u4e60\u60ef\uff0c\u6709\u5982\u4e0b\u7684\u597d\u5904\uff1a","source":"@site/docs/Vue/14.Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790.md","sourceDirName":"Vue","slug":"/Vue/Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790","permalink":"/docs/Vue/Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Vue/14.Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{},"sidebar":"Vue3SiderBar","previous":{"title":"Pinia\u63d2\u4ef6","permalink":"/docs/Vue/Pinia\u63d2\u4ef6"},"next":{"title":"Vue\u6784\u9020\u51fd\u6570","permalink":"/docs/Vue/Vue\u6784\u9020\u51fd\u6570"}}');var i=t(4848),o=t(8453);const r={},c="Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790",a={},u=[{value:"defineStore \u65b9\u6cd5",id:"definestore-\u65b9\u6cd5",level:2},{value:"storeToRefs \u65b9\u6cd5",id:"storetorefs-\u65b9\u6cd5",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790",children:"Pinia\u90e8\u5206\u6e90\u7801\u89e3\u6790"})}),"\n",(0,i.jsx)(n.p,{children:"\u517b\u6210\u9605\u8bfb\u6e90\u7801\u7684\u4e60\u60ef\uff0c\u6709\u5982\u4e0b\u7684\u597d\u5904\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9605\u8bfb\u6e90\u7801\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u6269\u5bbd\u81ea\u5df1\u7684\u89c6\u91ce\uff0c\u53ef\u4ee5\u770b\u5230\u4f18\u79c0\u7684\u7a0b\u5e8f\u5458\u662f\u5982\u4f55\u4e66\u5199\u4ee3\u7801\u7684\uff0c\u4ece\u800c\u63d0\u5347\u6211\u4eec\u81ea\u5df1\u7684\u7f16\u7801\u6c34\u5e73"}),"\n",(0,i.jsx)(n.li,{children:"\u77e5\u5176\u7136\u77e5\u5176\u6240\u4ee5\u7136\u3002\u5982\u679c\u4f60\u9605\u8bfb\u8fc7\u6e90\u7801\uff0c\u90a3\u4e48\u4f60\u81ea\u7136\u80fd\u591f\u77e5\u9053\u67d0\u4e00\u4e2a API \u662f\u5982\u4f55\u5b9e\u73b0\uff0c\u80cc\u540e\u7684\u5b9e\u73b0\u539f\u7406\u662f\u4ec0\u4e48\uff0c\u90a3\u4e48\u4f60\u4e5f\u5c31\u80fd\u591f\u81ea\u7136\u7684\u907f\u514d\u5728\u4f7f\u7528\u8be5 API \u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u7684\u4e00\u4e9b bug\uff0c\u4f1a\u6709\u4e00\u4e9b\u81ea\u5df1\u72ec\u7279\u7684\u4f18\u5316\u5fc3\u5f97"}),"\n",(0,i.jsx)(n.li,{children:"\u6700\u540e\u4e00\u70b9\u5c31\u662f\u9605\u8bfb\u6e90\u7801\u80fd\u591f\u51b2\u51fb\u5927\u5382\uff0c\u5927\u5382\u5728\u9762\u8bd5\u7684\u65f6\u5019\u4e0d\u4f1a\u8003\u5bdf\u67d0\u4e2a API \u5982\u4f55\u4f7f\u7528\uff0c\u6ca1\u4ec0\u4e48\u610f\u4e49\uff0c\u56e0\u4e3a API \u7ecf\u5e38\u4e5f\u5728\u53d8\u5316\uff0c\u4e00\u822c\u90fd\u662f\u8003\u5bdf API \u80cc\u540e\u7684\u539f\u7406"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u9605\u8bfb\u6e90\u7801\u65f6\u7684\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9605\u8bfb\u6e90\u7801\u57fa\u4e8e\u4f60\u5df2\u7ecf\u4f7f\u7528\u8fc7\u4e86\u8be5\u5e93\u6216\u8005\u8be5\u6846\u67b6\uff0c\u5bf9\u91cc\u9762\u7684 API \u5df2\u7ecf\u5f88\u719f\u6089\u4e86\uff0c\u662f\u4e00\u79cd\u81ea\u53d1\u7684\u884c\u4e3a"}),"\n",(0,i.jsxs)(n.li,{children:["\u9605\u8bfb\u6e90\u7801\u4e00\u5b9a\u8981",(0,i.jsx)(n.strong,{children:"\u8010\u5fc3"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u8981",(0,i.jsx)(n.strong,{children:"\u9677\u5165\u4e8e\u7ec6\u8282"}),"\uff0c\u5728\u9605\u8bfb\u6e90\u7801\u7684\u65f6\u5019\u5f80\u5f80\u9700\u8981\u4f60\u7ad9\u5728\u4e00\u4e2a\u66f4\u9ad8\u7684\u89d2\u5ea6"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"definestore-\u65b9\u6cd5",children:"defineStore \u65b9\u6cd5"}),"\n",(0,i.jsx)(n.p,{children:"\u56de\u987e defineStore \u65b9\u6cd5\u7684\u4f7f\u7528\u3002defineStore \u65b9\u6cd5\u652f\u6301\u4e24\u79cd\u53d8\u6210\u98ce\u683c\uff0c\u4e00\u79cd\u662f option store\uff0c\u53e6\u4e00\u79cd\u662f setup store"}),"\n",(0,i.jsx)(n.p,{children:"option store \u98ce\u683c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"export const useCounterStore = defineStore('counter', {\n  state: () => ({ count: 0 }),\n  getters: {\n    double: (state) => state.count * 2,\n  },\n  actions: {\n    increment() {\n      this.count++\n    },\n  },\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:"option store \u98ce\u683c\u53ef\u4ee5\u5c06 id \u5199\u5230\u9009\u9879\u91cc\u9762\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"export const useCounterStore = defineStore({\n  id: 'counter',\n  state: () => ({ count: 0 }),\n  getters: {\n    double: (state) => state.count * 2,\n  },\n  actions: {\n    increment() {\n      this.count++\n    },\n  },\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:"setup store \u98ce\u683c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"export const useCounterStore = defineStore('counter', () => {\n  const count = ref(0)\n  function increment() {\n    count.value++\n  }\n\n  return { count, increment }\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:"defineStore \u5bf9\u5e94\u7684\u6e90\u7801\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"function defineStore(\n// TODO: add proper types from above\nidOrOptions, setup, setupOptions) {\n    let id;\n    let options;\n    // isSetupStore \u4f1a\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5982\u679c\u662f setup \u51fd\u6570\uff0cisSetupStore \u4e3a true\uff0c\u5426\u5219\u4e3a false\n    const isSetupStore = typeof setup === 'function';\n    if (typeof idOrOptions === 'string') {\n        // \u5982\u679c\u8fdb\u5165\u6b64 if\uff0c\u8bf4\u660e idOrOptions \u662f\u8be5\u4ed3\u5e93\u7684 id\n        // id \u662f defineStore \u51fd\u6570\u5185\u90e8\u7684\u53d8\u91cf\uff0c\u5b58\u50a8\u4ed3\u5e93 id\n        id = idOrOptions;\n        // the option store setup will contain the actual options in this case\n        // \u5982\u679c\u662f setup \u98ce\u683c\uff0c\u5c31\u5c06\u7b2c\u4e09\u4e2a\u53c2\u6570\uff08\u5982\u679c\u6709\uff09\u8d4b\u503c\u7ed9 options\uff0c\u5426\u5219\u5c31\u5c06\u914d\u7f6e\u5bf9\u8c61\u8d4b\u503c\u7ed9 options\n        options = isSetupStore ? setupOptions : setup;\n    }\n    else {\n        // idOrOptions \u53c2\u6570\u4e3a\u914d\u7f6e\u5bf9\u8c61\n        options = idOrOptions;\n        id = idOrOptions.id;\n    }\n    // \u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u6700\u7ec8\u8fd4\u56de\u7ed9\u5916\u90e8\u7684\u51fd\u6570\n    // \u5916\u90e8\u901a\u8fc7\u6267\u884c\u8fd9\u4e2a\u51fd\u6570\u62ff\u5230 store \u4ed3\u5e93 \n    function useStore(pinia, hot) {\n        const currentInstance = getCurrentInstance();\n        pinia =\n            // in test mode, ignore the argument provided as we can always retrieve a\n            // pinia instance with getActivePinia()\n            (pinia) ||\n                (currentInstance && inject(piniaSymbol, null));\n        if (pinia)\n            setActivePinia(pinia);\n        if (!activePinia) {\n            throw new Error(`[\ud83c\udf4d]: getActivePinia was called with no active Pinia. Did you forget to install pinia?\\n` +\n                `\\tconst pinia = createPinia()\\n` +\n                `\\tapp.use(pinia)\\n` +\n                `This will fail in production.`);\n        }\n        pinia = activePinia;\n        if (!pinia._s.has(id)) {\n            // creating the store registers it in `pinia._s`\n            // \u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a\u4ed3\u5e93\u6ce8\u518c\u5230 pinia._s\n            // \u6839\u636e\u4e0d\u540c\u7684\u98ce\u683c\u5f00\u59cb\u521b\u5efa\u4ed3\u5e93\n            if (isSetupStore) {\n                // \u5982\u679c\u662f setup \u98ce\u683c\uff0c\u8c03\u7528\u7684\u662f createSetupStore\n                createSetupStore(id, setup, options, pinia);\n            }\n            else {\n                // \u5982\u679c\u662f option \u98ce\u683c\uff0c\u8c03\u7528\u7684\u662f createOptionsStore\n                // createOptionsStore \u65b9\u6cd5\u80cc\u540e\u5b9e\u9645\u4e0a\u4e5f\u662f\u5728\u8c03\u7528 createSetupStore\uff0c\u5185\u90e8\u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a setup \u7684\u51fd\u6570\n                // \u5c06\u9009\u9879\u8f6c\u4e3a setup \u51fd\u6570\u5185\u90e8\u7684\u9879\u76ee\uff0c\u7136\u540e\u8c03\u7528 createSetupStore \u65b9\u6cd5\uff0c\u5c06 setup \u51fd\u6570\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u9012\u8fc7\u53bb\n                // \u56e0\u6b64\u7406\u8bba\u4e0a\u6765\u8bb2\uff0csetup \u5b9e\u8df5\u4e0a\u8981\u66f4\u52a0\u9ad8\u6548\u4e00\u4e9b\uff0c\u56e0\u4e3a option store \u80cc\u540e\u4e5f\u662f\u8f6c\u4e3a setup\uff0c\u8fd9\u4e9b\u662f\u4f60\u4e0d\u9605\u8bfb\u6e90\u7801\u65e0\u6cd5\u77e5\u9053\u7684\n                createOptionsStore(id, options, pinia);\n            }\n            /* istanbul ignore else */\n            {\n                // @ts-expect-error: not the right inferred type\n                useStore._pinia = pinia;\n            }\n        }\n        const store = pinia._s.get(id);\n        if (hot) {\n            const hotId = '__hot:' + id;\n            const newStore = isSetupStore\n                ? createSetupStore(hotId, setup, options, pinia, true)\n                : createOptionsStore(hotId, assign({}, options), pinia, true);\n            hot._hotUpdate(newStore);\n            // cleanup the state properties and the store from the cache\n            delete pinia.state.value[hotId];\n            pinia._s.delete(hotId);\n        }\n        // save stores in instances to access them devtools\n        if (IS_CLIENT &&\n            currentInstance &&\n            currentInstance.proxy &&\n            // avoid adding stores that are just built for hot module replacement\n            !hot) {\n            const vm = currentInstance.proxy;\n            const cache = '_pStores' in vm ? vm._pStores : (vm._pStores = {});\n            cache[id] = store;\n        }\n        // StoreGeneric cannot be casted towards Store\n        return store;\n    }\n    useStore.$id = id; // \u5728 useStore \u51fd\u6570\u4e0a\u9762\u8fd8\u6302\u4e86\u4e00\u4e2a $id\uff0c\u5b58\u50a8\u4e86\u8be5\u4ed3\u5e93\u7684 id\n    return useStore; // \u5728\u5411\u5916\u90e8\u8fd4\u56de\u8fd9\u4e2a\u51fd\u6570\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"storetorefs-\u65b9\u6cd5",children:"storeToRefs \u65b9\u6cd5"}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\u6211\u4eec\u8fd8\u662f\u56de\u987e\u8be5\u65b9\u6cd5\u7684\u7528\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-vue",children:"<script setup>\nimport { storeToRefs } from 'pinia'\nconst store = useCounterStore()\nconst { name, doubleCount } = storeToRefs(store)\nconst { increment } = store\n<\/script>\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6e90\u7801\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"function storeToRefs(store) {\n    // See https://github.com/vuejs/pinia/issues/852\n    // It's easier to just use toRefs() even if it includes more stuff\n    // \u9488\u5bf9 Vue2 \u7248\u672c\u7684\u5904\u7406\n    if (isVue2) {\n        // @ts-expect-error: toRefs include methods and others\n        return toRefs(store);\n    }\n    else {\n        store = toRaw(store);\n        // \u521b\u5efa\u4e86\u4e00\u4e2a\u7a7a\u5bf9\u8c61\n        const refs = {};\n        // \u904d\u5386\u4ed3\u5e93\u5bf9\u8c61\n        for (const key in store) {\n            // \u62ff\u5230\u4ed3\u5e93\u5bf9\u8c61\u5bf9\u5e94\u7684\u6bcf\u4e00\u9879\u7684\u503c\n            const value = store[key];\n            if (isRef(value) || isReactive(value)) {\n                // @ts-expect-error: the key is state or getter\n                // \u5982\u679c\u8fd9\u4e2a\u503c\u672c\u8eab\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u5c06\u8fd9\u4e2a\u503c\u4ee5\u539f\u672c\u7684 key \u6dfb\u52a0\u5230 refs \u5bf9\u8c61\u4e0a\u9762\n                refs[key] =\n                    // ---\n                    toRef(store, key);\n            }\n        }\n        // \u6574\u4e2a for \u5faa\u73af\u5b8c\u4e86\u4e4b\u540e\uff0c\u6240\u6709\u54cd\u5e94\u5f0f\u7684\u503c\u88ab\u6dfb\u52a0\u5230\u4e86 refs \u5bf9\u8c61\u4e0a\u9762\n        // \u5411\u5916\u90e8\u8fd4\u56de\u8fd9\u4e2a refs \u5bf9\u8c61\n        return refs;\n    }\n}\n"})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);