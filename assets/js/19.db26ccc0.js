(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{435:function(s,t,a){"use strict";a.r(t);var n=a(31),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"安装mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装mongodb"}},[s._v("#")]),s._v(" 安装mongodb")]),s._v(" "),a("h2",{attrs:{id:"配置yum源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置yum源"}},[s._v("#")]),s._v(" 配置yum源")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/yum.repos.d/mongodb.repo\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mongodb-org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MongoDB Repository\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.tuna.tsinghua.edu.cn/mongodb/yum/el"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releasever")]),s._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立yum源缓存")]),s._v("\n$ yum makecache\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有mongodb版本")]),s._v("\n$ yum list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mongodb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装org版本")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mongodb-org\n")])])]),a("h2",{attrs:{id:"启动mongodb-并设置开机启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动mongodb-并设置开机启动"}},[s._v("#")]),s._v(" 启动mongodb 并设置开机启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status mongod")]),s._v("\n● mongod.service - MongoDB Database Server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/mongod.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     Docs: https://docs.mongodb.org/manual\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start mongod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost yum.repos.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable mongod")]),s._v("\n")])])]),a("h2",{attrs:{id:"检查mongodb的服务状态和端口监听信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查mongodb的服务状态和端口监听信息"}},[s._v("#")]),s._v(" 检查"),a("strong",[s._v("MongoDB")]),s._v("的服务状态和端口监听信息")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status mongod.service")]),s._v("\n● mongod.service - MongoDB Database Server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/mongod.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Fri "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-12-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:49 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 16s ago\n     Docs: https://docs.mongodb.org/manual\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930807")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/mongod "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTIONS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930804")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/chmod 0755 /var/run/mongodb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930802")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/chown mongod:mongod /var/run/mongodb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930800")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/mkdir -p /var/run/mongodb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930809")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mongod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Memory: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(".7M\n   CGroup: /system.slice/mongod.service\n           └─930809 /usr/bin/mongod -f /etc/mongod.conf\n\nDec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:48 mongodb.lianglab.cn systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting MongoDB Database Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nDec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:48 mongodb.lianglab.cn mongod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930807")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": about to fork child process, waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" server is ready "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" connections.\nDec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:48 mongodb.lianglab.cn mongod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930807")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": forked process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930809")]),s._v("\nDec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:49 mongodb.lianglab.cn mongod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930807")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": child process started successfully, parent exiting\nDec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17:49 mongodb.lianglab.cn systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started MongoDB Database Server\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -anplt| grep mongod")]),s._v("\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:27017         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930809")]),s._v("/mongod       \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -anplt | grep mongod")]),s._v("\nLISTEN    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:27017            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*        users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"mongod"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("930809")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("                                           \n")])])]),a("h2",{attrs:{id:"创建初始超级管理员用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建初始超级管理员用户"}},[s._v("#")]),s._v(" 创建初始超级管理员用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("$ mongo\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("createUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("   {\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("     pwd: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("     roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" { role: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dbOwner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("db: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testdb"')]),s._v(" } "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("   }\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"创建操作用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建操作用户"}},[s._v("#")]),s._v(" 创建操作用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" testdb\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("createUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("{name:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pwd:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("roles:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("{role:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dbOwner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("db:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testdb"')]),s._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"centos-8上为mongodb创建selinux策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos-8上为mongodb创建selinux策略"}},[s._v("#")]),s._v(" CentOS 8上为MongoDB创建SELinux策略：")]),s._v(" "),a("p",[s._v("根据"),a("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB文档"),a("OutboundLink")],1),s._v("，如果您已将"),a("strong",[s._v("SELinux")]),s._v("配置为"),a("strong",[s._v("强制")]),s._v("模式，则必须为MongoDB创建SELinux策略。")]),s._v(" "),a("p",[s._v("检查当前的"),a("strong",[s._v("SELinux")]),s._v("模式。")]),s._v(" "),a("div",{staticClass:"language-shel extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@mongodb ~]# getenforce\nEnforcing\n")])])]),a("p",[s._v("我们需要"),a("strong",[s._v("checkpolicy")]),s._v("命令来验证自定义"),a("strong",[s._v("SELinux")]),s._v("策略，因此我们正在使用"),a("strong",[s._v("dnf")]),s._v("命令安装"),a("strong",[s._v("checkpolicy")]),s._v("软件包。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#dnf install -y checkpolicy")]),s._v("\nCentOS-8 - AppStream                            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.3")]),s._v(" kB     00:01\nCentOS-8 - Base                                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.8")]),s._v(" kB     00:01\nCentOS-8 - Extras                               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.5")]),s._v(" kB     00:00\nMongoDB Repository                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.5")]),s._v(" kB     00:01\nDependencies resolved.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n Package              Architecture    Version             Repository       Size\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nInstalling:\n checkpolicy          x86_64          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.9")]),s._v("-1.el8           BaseOS          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("348")]),s._v(" k\n\nTransaction Summary\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nInstall  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Package\n\nTotal download size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("348")]),s._v(" k\nInstalled size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v(" M\nDownloading Packages:\ncheckpolicy-2.9-1.el8.x86_64.rpm                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.5")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("348")]),s._v(" kB     00:46\n--------------------------------------------------------------------------------\nTotal                                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.5")]),s._v(" kB/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("348")]),s._v(" kB     00:46\nRunning transaction check\nTransaction check succeeded.\nRunning transaction "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nTransaction "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" succeeded.\nRunning transaction\n  Preparing        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("                                                        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1\n  Installing       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" checkpolicy-2.9-1.el8.x86_64                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1\n  Running scriptlet: checkpolicy-2.9-1.el8.x86_64                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1\n  Verifying        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" checkpolicy-2.9-1.el8.x86_64                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1\n\nInstalled:\n  checkpolicy-2.9-1.el8.x86_64\n\nComplete"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])])]),a("p",[s._v("创建一个定制的"),a("strong",[s._v("SELinux")]),s._v("策略文件。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@mongodb ~]# vi mongodb_cgroup_memory.te\n")])])]),a("p",[s._v("并在其中添加以下指令。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module mongodb_cgroup_memory 1.0;\n\nrequire {\n    type cgroup_t;\n    type mongod_t;\n    class dir search;\n    class file { getattr open read };\n}\n\n#============= mongod_t ==============\nallow mongod_t cgroup_t:dir search;\nallow mongod_t cgroup_t:file { getattr open read };\n")])])]),a("p",[s._v("编译并应用此SELinux策略。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# checkmodule -M -m -o mongodb_cgroup_memory.mod mongodb_cgroup_memory.te")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semodule_package -o mongodb_cgroup_memory.pp -m mongodb_cgroup_memory.mod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semodule -i mongodb_cgroup_memory.pp")]),s._v("\n")])])]),a("h2",{attrs:{id:"创建admin账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建admin账号"}},[s._v("#")]),s._v(" 创建admin账号")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo")]),s._v("\nMongoDB shell version v4.4.6\nconnecting to: mongodb://127.0.0.1:27017/?compressors"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gssapiServiceName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mongodb\nImplicit session: session "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2df728ce-2a97-4635-b9c5-81e0f00923c6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nMongoDB server version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(".6\n---\nThe server generated these startup warnings when booting: \n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-29T20:42:30.610+08:00: Access control is not enabled "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the database. Read and "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" access to data and configuration is unrestricted\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-29T20:42:30.611+08:00: /sys/kernel/mm/transparent_hugepage/enabled is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'always'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" We suggest setting it to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'never'")]),s._v("\n---\n---\n        Enable MongoDB's "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" cloud-based monitoring service, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" will "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" receive and display\n        metrics about your deployment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("disk utilization, CPU, operation statistics, etc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n\n        The monitoring data will be available on a MongoDB website with a unique URL accessible to you\n        and anyone you share the URL with. MongoDB may use this information to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" product\n        improvements and to suggest MongoDB products and deployment options to you.\n\n        To "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" monitoring, run the following command: db.enableFreeMonitoring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        To permanently disable this reminder, run the following command: db.disableFreeMonitoring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n---\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nswitched to db admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.createUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".     user: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".     pwd: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"liang123"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".     roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" role: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(",db: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nSuccessfully added user: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"role"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(",\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin.admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userId"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"91c06ceb-0dc4-4687-a467-679a9a8c75fa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"role"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(",\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mechanisms"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCRAM-SHA-1"')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCRAM-SHA-256"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\nbye\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])])]),a("h2",{attrs:{id:"mongodb服务器中启用访问控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb服务器中启用访问控制"}},[s._v("#")]),s._v(" MongoDB服务器中启用访问控制：")]),s._v(" "),a("p",[s._v("最初，访问控制在MongoDB服务器中被禁用。因此，任何具有CentOS 8服务器操作系统级访问权限的用户都可以连接到MongoDB实例并在数据库上执行管理操作。这就是为什么我们能够在上一步中创建"),a("strong",[s._v("管理员")]),s._v("用户而无需任何身份验证的原因。")]),s._v(" "),a("p",[s._v("要为MongoDB服务器启用"),a("strong",[s._v("访问控制")]),s._v("，我们需要为"),a("strong",[s._v("mongod.service")]),s._v("编辑"),a("strong",[s._v("systemd")]),s._v("单元文件。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /usr/lib/systemd/system/mongod.service")]),s._v("\n")])])]),a("p",[s._v("在此文件中找到以下行。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS=-f /etc/mongod.conf"')]),s._v("\n")])])]),a("p",[s._v("并将其替换为以下行。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS=--auth -f /etc/mongod.conf"')]),s._v("\n")])])]),a("p",[s._v("我们已经使用文本编辑器显式地编辑了"),a("strong",[s._v("systemd")]),s._v("单位文件。因此，我们需要执行以下命令来通知"),a("strong",[s._v("systemd")]),s._v("有关此更改。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n")])])]),a("p",[s._v("重新启动"),a("strong",[s._v("MongoDB")]),s._v("服务以应用更改。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart mongod.service")]),s._v("\n")])])]),a("p",[s._v("要检查访问控制，请连接"),a("strong",[s._v("MongoDB")]),s._v(" shell并执行一些管理命令。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo")]),s._v("\nMongoDB shell version v4.4.6\nconnecting to: mongodb://127.0.0.1:27017/?compressors"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gssapiServiceName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mongodb\nImplicit session: session "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d07e43a9-d2f5-4884-b9df-962f76fa7b77"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nMongoDB server version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(".6\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nswitched to db admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nuncaught exception: Error: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" usersInfo requires authentication "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n_getErrorWithCode@src/mongo/shell/utils.js:25:13\nDB.prototype.getUsers@src/mongo/shell/db.js:1659:15\nshellHelper.show@src/mongo/shell/utils.js:914:9\nshellHelper@src/mongo/shell/utils.js:819:15\n@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shellhelp2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":1:1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])])]),a("p",[s._v("这次“ "),a("strong",[s._v("show user”"),a("strong",[s._v("命令引发身份验证错误，它确认在我们的MongoDB服务器中已启用")]),s._v("访问控制")]),s._v("。")]),s._v(" "),a("p",[s._v("现在，以"),a("strong",[s._v("管理员")]),s._v("用户身份连接。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",passwordPrompt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\nEnter password: \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin.admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userId"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"91c06ceb-0dc4-4687-a467-679a9a8c75fa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"role"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(",\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mechanisms"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCRAM-SHA-1"')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCRAM-SHA-256"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])])]),a("p",[s._v("已成功使用特权用户执行命令**“显示用户”**。")]),s._v(" "),a("p",[s._v("MongoDB数据库的"),a("strong",[s._v("访问控制")]),s._v("已启用。")]),s._v(" "),a("h2",{attrs:{id:"配置mongodb服务以进行网络访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置mongodb服务以进行网络访问"}},[s._v("#")]),s._v(" 配置MongoDB服务以进行网络访问：")]),s._v(" "),a("p",[s._v("此步骤是可选的。如果您打算通过网络访问MongoDB数据库，则必须执行以下配置。")]),s._v(" "),a("p",[s._v("默认情况下，MongoDB服务在"),a("strong",[s._v("本地主机")]),s._v("接口上运行。因此，要使其能够从网络访问，我们需要在所有接口上运行MongoDB服务。")]),s._v(" "),a("p",[s._v("使用"),a("strong",[s._v("vim")]),s._v("编辑器编辑MongoDB配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/mongod.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# network interfaces")]),s._v("\nnet:\n  port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  bindIp: 127.0.0.1  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.")]),s._v("\n  bindIp: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.")]),s._v("\n")])])]),a("h2",{attrs:{id:"重新启动mongodb服务以应用更改。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重新启动mongodb服务以应用更改。"}},[s._v("#")]),s._v(" 重新启动MongoDB服务以应用更改。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart mongod.service")]),s._v("\n")])])]),a("h2",{attrs:{id:"防火墙设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙设置"}},[s._v("#")]),s._v(" 防火墙设置")]),s._v(" "),a("p",[s._v("设置如果我们启动了防火墙策略，还需要允许Linux防火墙中的MongoDB服务传入流量。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@mongodb ~]#firewall-cmd --permanent --add-service=mongodb\nsuccess\n[root@mongodb ~]# firewall-cmd --reload\nsuccess\n")])])]),a("p",[s._v("您现在可以从网络访问MongoDB数据库服务。")]),s._v(" "),a("h2",{attrs:{id:"mongodb数据和日志目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb数据和日志目录"}},[s._v("#")]),s._v(" MongoDB数据和日志目录：")]),s._v(" "),a("p",[s._v("以下是两个目录，对MongoDB数据库管理员来说非常重要。")]),s._v(" "),a("ul",[a("li",[s._v("**/var/lib/mongo-**数据目录（默认）")]),s._v(" "),a("li",[s._v("**/var/log/mongodb-**日志目录（默认）")])]),s._v(" "),a("p",[s._v("我们可以通过在**/etc/mongodb.conf**文件中设置以下参数来自定义以上目录。")]),s._v(" "),a("ul",[a("li",[s._v("**storage.dbPath-**指定新的数据目录路径")]),s._v(" "),a("li",[s._v("**systemLog.path-**指定新的日志文件路径")])]),s._v(" "),a("h2",{attrs:{id:"基本用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本用法"}},[s._v("#")]),s._v(" 基本用法")]),s._v(" "),a("h3",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),a("p",[s._v("show dbs 查看数据库")]),s._v(" "),a("p",[s._v("use dbname 进入数据库")]),s._v(" "),a("p",[s._v("show users 查看当前数据库用户权限")]),s._v(" "),a("h3",{attrs:{id:"创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[s._v("#")]),s._v(" "),a("strong",[s._v("创建用户")])]),s._v(" "),a("p",[s._v('db.createUser({user:"usertest",pwd:"passtest",roles:[ {role:"clusterAdmin", db:"admin" }, {role:"readAnyDatabase",db:"admin" }, {role:"readWrite",db:"testDB" } ]})')]),s._v(" "),a("h3",{attrs:{id:"权限详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#权限详解"}},[s._v("#")]),s._v(" "),a("strong",[s._v("权限详解")])]),s._v(" "),a("h4",{attrs:{id:"内建角色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内建角色"}},[s._v("#")]),s._v(" 内建角色：")]),s._v(" "),a("p",[s._v("数据库用户角色：read、readWrite；")]),s._v(" "),a("p",[s._v("数据库管理角色：dbAdmin、dbOwner、userAdmin；")]),s._v(" "),a("p",[s._v("集群管理角色： clusterAdmin、clusterManager、clusterMonitor、hostManager；")]),s._v(" "),a("p",[s._v("备份恢复角色： backup、restore；")]),s._v(" "),a("p",[s._v("所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase")]),s._v(" "),a("p",[s._v("超级用户角色： root； 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）")]),s._v(" "),a("p",[s._v("内部角色： __system；")]),s._v(" "),a("p",[s._v("------------------------------------------------------------------------------------------")]),s._v(" "),a("h4",{attrs:{id:"角色说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角色说明"}},[s._v("#")]),s._v(" 角色说明：")]),s._v(" "),a("p",[s._v("Read： 允许用户读取指定数据库")]),s._v(" "),a("p",[s._v("readWrite： 允许用户读写指定数据库")]),s._v(" "),a("p",[s._v("dbAdmin： 允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile")]),s._v(" "),a("p",[s._v("userAdmin： 允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户")]),s._v(" "),a("p",[s._v("dbOwner： 允许在当前DB中执行任意操作")]),s._v(" "),a("p",[s._v("readAnyDatabase： 赋予用户所有数据库的读权限，只在admin数据库中可用")]),s._v(" "),a("p",[s._v("readWriteAnyDatabase： 赋予用户所有数据库的读写权限，只在admin数据库中可用")]),s._v(" "),a("p",[s._v("userAdminAnyDatabase：赋予用户所有数据库管理User的权限，只在admin数据库中可用")]),s._v(" "),a("p",[s._v("dbAdminAnyDatabase： 赋予管理所有数据库的权限，只在admin数据库中可用")]),s._v(" "),a("p",[s._v("root： 超级账号，超级权限，只在admin数据库中可用。")]),s._v(" "),a("p",[s._v("------------------------------------------------------------------------------------------")]),s._v(" "),a("h4",{attrs:{id:"集群管理角色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群管理角色"}},[s._v("#")]),s._v(" 集群管理角色：")]),s._v(" "),a("p",[s._v("clusterAdmin： 赋予管理集群的最高权限，只在admin数据库中可用")]),s._v(" "),a("p",[s._v("clusterManager： 赋予管理和监控集群的权限")]),s._v(" "),a("p",[s._v("clusterMonitor： 赋予监控集群的权限，对监控工具具有readonly的权限")]),s._v(" "),a("p",[s._v("hostManager： 赋予管理Server")]),s._v(" "),a("h3",{attrs:{id:"修改密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改密码"}},[s._v("#")]),s._v(" "),a("strong",[s._v("修改密码")])]),s._v(" "),a("p",[s._v('方法1：db.changeUserPassword("usertest","changepass");')]),s._v(" "),a("p",[s._v('方法2：db.updateUser("usertest",{pwd:"changepass1"})；')]),s._v(" "),a("h3",{attrs:{id:"修改权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改权限"}},[s._v("#")]),s._v(" "),a("strong",[s._v("修改权限")])]),s._v(" "),a("p",[s._v('db.updateUser("usertest",{roles:[ {role:"read",db:"testDB"} ]})')]),s._v(" "),a("p",[s._v("注：updateuser它是完全替换之前的值，如果要新增或添加roles而不是代替它")]),s._v(" "),a("p",[s._v("则使用方法： db.grantRolesToUser() 和 db.revokeRolesFromUser(）")]),s._v(" "),a("p",[s._v("------------------------------------------------------------------------------------------")]),s._v(" "),a("p",[s._v('db.grantRolesToUser("usertest", [{role:"readWrite", db:"testDB"},{role:"read", db:"testDB"}]) # 修改权限')]),s._v(" "),a("p",[s._v('db.revokeRolesFromUser("usertest",[{role:"read", db:"testDB"}]) # 删除权限：')]),s._v(" "),a("h3",{attrs:{id:"删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除用户"}},[s._v("#")]),s._v(" "),a("strong",[s._v("删除用户")])]),s._v(" "),a("p",[s._v("db.dropUser('usertest')")]),s._v(" "),a("p",[s._v("参考：")]),s._v(" "),a("p",[s._v("https://jingyan.baidu.com/article/dca1fa6f0428a4f1a440522e.html")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/lianglab/p/14157585.html")])])}),[],!1,null,null,null);t.default=e.exports}}]);